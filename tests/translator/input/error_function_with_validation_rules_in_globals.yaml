AWSTemplateFormatVersion: '2010-09-09'
Transform: AWS::Serverless-2016-10-31

Globals:
  Function:
    CapacityProviderConfig:
      Arn: arn:aws:lambda:us-east-1:123456789012:capacity-provider/test
      PerExecutionEnvironmentMaxConcurrency: 10

Resources:
  GlobalFunction1:
    Type: AWS::Serverless::Function
    Properties:
      InlineCode: |
        exports.handler = async (event) => {
          return {
            statusCode: 200,
            body: JSON.stringify({ message: "Hello World" }),
          };
        };
      Handler: index.handler
      Runtime: nodejs18.x
      # This should work fine because it's using the global CapacityProviderConfig

  GlobalFunction2:
    Type: AWS::Serverless::Function
    Properties:
      InlineCode: |
        exports.handler = async (event) => {
          return {
            statusCode: 200,
            body: JSON.stringify({ message: "Hello World" }),
          };
        };
      Handler: index.handler
      Runtime: nodejs18.x
      # This should fail because ProvisionedConcurrencyConfig is mutually exclusive with CapacityProviderConfig
      ProvisionedConcurrencyConfig:
        ProvisionedConcurrentExecutions: 10
